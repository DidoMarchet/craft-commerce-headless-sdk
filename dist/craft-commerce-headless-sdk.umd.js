(function(p,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(p=typeof globalThis<"u"?globalThis:p||self,l(p.CraftCommerceHeadlessSdk={}))})(this,function(p){"use strict";const l=e=>/^[a-zA-Z0-9.-]+$/.test(e),f=(e,n)=>{var o;if(!l(n))return null;const a=`; ${document.cookie}`.split(`; ${e}=`);return a.length===2&&((o=a.pop())==null?void 0:o.split(";").shift())||null},g=({apiBaseUrl:e})=>{e.endsWith("/")||(e+="/");let r=f("CRAFT_CSRF_TOKEN",e);const a=async()=>{const s=await fetch(`${e}actions/users/session-info`,{headers:{Accept:"application/json"},credentials:"include"});if(!s.ok){const d=await s.json().catch(()=>({}));throw console.error(d),new Error("Failed to fetch CSRF token")}return r=(await s.json()).csrfTokenValue,r},o=async(s,u,d={})=>{try{r||(r=await a());const{accept:t="application/json",contentType:w="application/json",...y}=d,m=u!==void 0?JSON.stringify(u):void 0,c=await fetch(`${e}${s}`,{method:"POST",headers:{"Content-Type":w,Accept:t,"X-CSRF-Token":r,"X-Requested-With":"XMLHttpRequest",...y},body:m,credentials:"include"});if(!c.ok){const h=await c.json().catch(()=>({}));return console.error(h.message||"API request failed"),c.status===400&&h.message==="Unable to verify your data submission."?(console.warn("CSRF token expired or invalid. Refreshing token..."),r=null,await o(s,u)):h}return t==="application/pdf"?await c.blob():await c.json()}catch(t){throw console.error("Error making POST request:",t),t}};return{post:o,get:async(s,u={},d={})=>{try{const{accept:t="application/json",...w}=d,y=new URL(s,e);Object.keys(u).forEach(c=>{u[c]!==void 0&&u[c]!==null&&y.searchParams.append(c,String(u[c]))});const m=await fetch(y.toString(),{method:"GET",headers:{Accept:t,"X-Requested-With":"XMLHttpRequest",...w},credentials:"include"});if(!m.ok){const c=await m.json().catch(()=>({}));return console.error(c.message||"API request failed"),c}return t==="application/pdf"?await m.blob():await m.json()}catch(t){throw console.error("Error making GET request:",t),t}}}},S=e=>({loginUser:async t=>await e.post("actions/users/login",t),saveUser:async t=>await e.post("actions/users/save-user",t),uploadUserPhoto:async t=>await e.post("actions/users/upload-user-photo",t),sendPasswordResetEmail:async t=>await e.post("actions/users/send-password-reset-email",t),setPassword:async t=>await e.post("actions/users/set-password",t),saveAddress:async t=>await e.post("actions/users/save-address",t),deleteAddress:async t=>await e.post("actions/users/delete-address",t),getSessionInfo:async()=>await e.get("actions/users/session-info")}),b=e=>({completeCart:async s=>await e.post("actions/commerce/cart/complete",s),getCart:async()=>await e.get("actions/commerce/cart/get-cart"),loadCart:async s=>await e.post("actions/commerce/cart/load-cart",s),forgetCart:async()=>await e.post("actions/commerce/cart/forget-cart",void 0,{accept:"text/html"}),updateCart:async s=>await e.post("actions/commerce/cart/update-cart",s)}),P=e=>({addPaymentSource:async o=>await e.post("actions/commerce/payment-sources/add",o),setPrimaryPaymentSource:async o=>await e.post("actions/commerce/payment-sources/set-primary-payment-source",o),deletePaymentSource:async o=>await e.post("actions/commerce/payment-sources/delete",o)}),v=e=>({completePayment:async a=>await e.get("actions/commerce/payments/complete-payment",a),pay:async a=>await e.post("actions/commerce/payments/pay",a)}),k=e=>({subscribe:async i=>await e.post("actions/commerce/subscriptions/subscribe",i),cancel:async i=>await e.post("actions/commerce/subscriptions/cancel",i),switchPlan:async i=>await e.post("actions/commerce/subscriptions/switch",i),reactivate:async i=>await e.post("actions/commerce/subscriptions/reactivate",i)}),T=({apiBaseUrl:e})=>{const n=g({apiBaseUrl:e}),r=S(n),a=b(n),o=P(n),i=v(n),s=k(n);return{client:n,users:r,cart:a,paymentSources:o,payment:i,subscriptions:s}};p.craftCommerceHeadlessSdk=T,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
