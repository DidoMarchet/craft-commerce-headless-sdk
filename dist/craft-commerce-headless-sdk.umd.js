(function(u,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(u=typeof globalThis<"u"?globalThis:u||self,i(u.CraftCommerceHeadlessSdk={}))})(this,function(u){"use strict";var $=Object.defineProperty;var q=(u,i,l)=>i in u?$(u,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[i]=l;var b=(u,i,l)=>(q(u,typeof i!="symbol"?i+"":i,l),l);const i=t=>/^[a-zA-Z0-9.-]+$/.test(t),l=(t,e)=>{var s;if(!i(e))return null;const r=`; ${document.cookie}`.split(`; ${t}=`);return r.length===2&&((s=r.pop())==null?void 0:s.split(";").shift())||null};class P extends Error{constructor(n,r,s,c,o,p){super(n);b(this,"status");b(this,"data");b(this,"endpoint");b(this,"method");b(this,"retryCount");this.name="ApiError",this.status=r,this.data=s,this.endpoint=c,this.method=o,this.retryCount=p,Object.setPrototypeOf(this,P.prototype)}}function h(t,...e){t&&console.log(...e)}let m=null,y=!1,T=1,f="YOUR_API_BASE_URL";function v(t){return t.endsWith("/")?t:t+"/"}async function R(){if(m||(m=l("CRAFT_CSRF_TOKEN",f)),m)return m;const e=await fetch(`${f}actions/users/session-info`,{headers:{Accept:"application/json"},credentials:"include"});if(!e.ok){const r=await e.json().catch(()=>({})),s=r.message||`Failed to fetch CSRF token with status ${e.status}`;throw new P(s,e.status,r,"actions/users/session-info","GET",0)}return m=(await e.json()).csrfTokenValue,m}async function C(t){let e="API request failed";try{const n=await t.json();n.error?e=n.error:n.errors?e=Object.values(n.errors).flat().join(", "):e=n.message||e}catch{e=await t.text()||t.statusText||e}return e=`(${t.status}) ${e}`,new Error(e)}function j(t){y=!!t.enableLogging,T=t.maxRetries??1,f=v(t.apiBaseUrl),h(y,"Craft Commerce using base URL:",f);const e=async(r,s,c={},o=0)=>{try{m||(m=await R());const{accept:p="application/json",contentType:g="application/json",...a}=c,d=s!==void 0?JSON.stringify(s):void 0;h(y,"Craft Commerce POST request:",r,{retryCount:o,body:d});const w=await fetch(`${f}${r}`,{method:"POST",headers:{"Content-Type":g,Accept:p,"X-CSRF-Token":m,"X-Requested-With":"XMLHttpRequest",...a},body:d,credentials:"include"});if(!w.ok){const S=await w.json().catch(()=>({}));if(h(y,"Craft Commerce POST error data:",S),o<T&&w.status===400&&S.message==="Unable to verify your data submission.")return console.warn("CSRF token invalid. Retrying request..."),m=null,e(r,s,c,o+1);const F=S.message||`API request failed with status ${w.status}`;throw new P(F,w.status,S,r,"POST",o)}return p==="application/pdf"?await w.blob():await w.json()}catch(p){throw h(y,"Craft Commerce POST caught error:",p),p}};return{post:e,get:async(r,s={},c={})=>{try{const{accept:o="application/json",...p}=c,g=new URL(r,f);Object.keys(s).forEach(d=>{s[d]!==void 0&&s[d]!==null&&g.searchParams.append(d,String(s[d]))}),h(y,"Craft Commerce GET request:",g.toString());const a=await fetch(g.toString(),{method:"GET",headers:{Accept:o,"X-Requested-With":"XMLHttpRequest",...p},credentials:"include"});if(!a.ok)throw console.error(`API GET error (${r}):`,await a.text()),await C(a);return o==="application/pdf"?await a.blob():await a.json()}catch(o){throw h(y,"Craft Commerce GET caught error:",o),o}}}}const A=t=>({loginUser:async a=>await t.post("actions/users/login",a),saveUser:async a=>await t.post("actions/users/save-user",a),uploadUserPhoto:async a=>await t.post("actions/users/upload-user-photo",a),sendPasswordResetEmail:async a=>await t.post("actions/users/send-password-reset-email",a),setPassword:async a=>await t.post("actions/users/set-password",a),saveAddress:async a=>await t.post("actions/users/save-address",a),deleteAddress:async a=>await t.post("actions/users/delete-address",a),getSessionInfo:async()=>await t.get("actions/users/session-info")}),k=t=>({completeCart:async o=>await t.post("actions/commerce/cart/complete",o),getCart:async()=>await t.get("actions/commerce/cart/get-cart"),loadCart:async o=>await t.post("actions/commerce/cart/load-cart",o),forgetCart:async()=>await t.post("actions/commerce/cart/forget-cart",void 0,{accept:"text/html"}),updateCart:async o=>await t.post("actions/commerce/cart/update-cart",o)}),E=t=>({addPaymentSource:async s=>await t.post("actions/commerce/payment-sources/add",s),setPrimaryPaymentSource:async s=>await t.post("actions/commerce/payment-sources/set-primary-payment-source",s),deletePaymentSource:async s=>await t.post("actions/commerce/payment-sources/delete",s)}),U=t=>({completePayment:async r=>await t.get("actions/commerce/payments/complete-payment",r),pay:async r=>await t.post("actions/commerce/payments/pay",r)}),O=t=>({subscribe:async c=>await t.post("actions/commerce/subscriptions/subscribe",c),cancel:async c=>await t.post("actions/commerce/subscriptions/cancel",c),switchPlan:async c=>await t.post("actions/commerce/subscriptions/switch",c),reactivate:async c=>await t.post("actions/commerce/subscriptions/reactivate",c)}),x=({apiBaseUrl:t})=>{const e=j({apiBaseUrl:t}),n=A(e),r=k(e),s=E(e),c=U(e),o=O(e);return{client:e,users:n,cart:r,paymentSources:s,payment:c,subscriptions:o}};u.craftCommerceHeadlessSdk=x,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
