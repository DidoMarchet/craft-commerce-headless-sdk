(function(u,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(u=typeof globalThis<"u"?globalThis:u||self,i(u.CraftCommerceHeadlessSdk={}))})(this,function(u){"use strict";var x=Object.defineProperty;var O=(u,i,m)=>i in u?x(u,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[i]=m;var P=(u,i,m)=>(O(u,typeof i!="symbol"?i+"":i,m),m);const i=t=>/^[a-zA-Z0-9.-]+$/.test(t),m=(t,e)=>{var s;if(!i(e))return null;const o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2&&((s=o.pop())==null?void 0:s.split(";").shift())||null};class f extends Error{constructor(a,o,s){super(a);P(this,"status");P(this,"data");this.name="ApiError",this.status=o,this.data=s,Object.setPrototypeOf(this,f.prototype)}}const S=1;let p=null,l="YOUR_API_BASE_URL";l.endsWith("/")||(l+="/");const b=async()=>{if(p=m("CRAFT_CSRF_TOKEN",l),p)return p;const e=await fetch(`${l}actions/users/session-info`,{headers:{Accept:"application/json"},credentials:"include"});if(!e.ok){const o=await e.json().catch(()=>({})),s=o.message||`Failed to fetch CSRF token with status ${e.status}`;throw new f(s,e.status,o)}return p=(await e.json()).csrfTokenValue,p},v=({apiBaseUrl:t})=>{l=t.endsWith("/")?t:`${t}/`;const e=async(o,s,c={},n=0)=>{try{p||(p=await b());const{accept:d="application/json",contentType:h="application/json",...r}=c,w=s!==void 0?JSON.stringify(s):void 0,y=await fetch(`${l}${o}`,{method:"POST",headers:{"Content-Type":h,Accept:d,"X-CSRF-Token":p,"X-Requested-With":"XMLHttpRequest",...r},body:w,credentials:"include"});if(!y.ok){const g=await y.json().catch(()=>({}));if(console.error(`API POST error (${o}):`,g.message||"API request failed"),n<S&&y.status===400&&g.message==="Unable to verify your data submission.")return console.warn("CSRF token expired or invalid. Retrying..."),p=null,await e(o,s,c,n+1);const F=g.message||`API request failed with status ${y.status}`;throw new f(F,y.status,g)}return d==="application/pdf"?await y.blob():await y.json()}catch(d){throw console.error(d),d}};return{post:e,get:async(o,s={},c={})=>{try{const{accept:n="application/json",...d}=c,h=new URL(o,l);Object.keys(s).forEach(w=>{s[w]!==void 0&&s[w]!==null&&h.searchParams.append(w,String(s[w]))});const r=await fetch(h.toString(),{method:"GET",headers:{Accept:n,"X-Requested-With":"XMLHttpRequest",...d},credentials:"include"});if(!r.ok)throw console.error(`API GET error (${o}):`,await r.text()),await j(r);return n==="application/pdf"?await r.blob():await r.json()}catch(n){throw console.error(n),n}}}},j=async t=>{let e="API request failed";try{const a=await t.json();a.error?e=a.error:a.errors?typeof a.errors=="object"?e=Object.values(a.errors).flat().join(", "):e=a.errors:e=a.message||e}catch{e=await t.text()||t.statusText||e}return e=`(${t.status}) ${e}`,new Error(e)},A=t=>({loginUser:async r=>await t.post("actions/users/login",r),saveUser:async r=>await t.post("actions/users/save-user",r),uploadUserPhoto:async r=>await t.post("actions/users/upload-user-photo",r),sendPasswordResetEmail:async r=>await t.post("actions/users/send-password-reset-email",r),setPassword:async r=>await t.post("actions/users/set-password",r),saveAddress:async r=>await t.post("actions/users/save-address",r),deleteAddress:async r=>await t.post("actions/users/delete-address",r),getSessionInfo:async()=>await t.get("actions/users/session-info")}),R=t=>({completeCart:async n=>await t.post("actions/commerce/cart/complete",n),getCart:async()=>await t.get("actions/commerce/cart/get-cart"),loadCart:async n=>await t.post("actions/commerce/cart/load-cart",n),forgetCart:async()=>await t.post("actions/commerce/cart/forget-cart",void 0,{accept:"text/html"}),updateCart:async n=>await t.post("actions/commerce/cart/update-cart",n)}),T=t=>({addPaymentSource:async s=>await t.post("actions/commerce/payment-sources/add",s),setPrimaryPaymentSource:async s=>await t.post("actions/commerce/payment-sources/set-primary-payment-source",s),deletePaymentSource:async s=>await t.post("actions/commerce/payment-sources/delete",s)}),k=t=>({completePayment:async o=>await t.get("actions/commerce/payments/complete-payment",o),pay:async o=>await t.post("actions/commerce/payments/pay",o)}),E=t=>({subscribe:async c=>await t.post("actions/commerce/subscriptions/subscribe",c),cancel:async c=>await t.post("actions/commerce/subscriptions/cancel",c),switchPlan:async c=>await t.post("actions/commerce/subscriptions/switch",c),reactivate:async c=>await t.post("actions/commerce/subscriptions/reactivate",c)}),$=({apiBaseUrl:t})=>{const e=v({apiBaseUrl:t}),a=A(e),o=R(e),s=T(e),c=k(e),n=E(e);return{client:e,users:a,cart:o,paymentSources:s,payment:c,subscriptions:n}};u.craftCommerceHeadlessSdk=$,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
